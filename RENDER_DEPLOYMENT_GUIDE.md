# Shifa AlHind - Render Deployment Guide

## Prerequisites

- GitHub/GitLab account
- Render account (free tier works)
- Your project code ready to deploy

## Issues Fixed

‚úÖ Added `rootDir: shifa-alhind` to render.yaml
‚úÖ Updated build command to include Prisma migrations
‚úÖ Enhanced Next.js config for production
‚úÖ Identified missing Prisma migrations (needs to be created)

---

## Step-by-Step Deployment

### 1. Create Prisma Migrations (CRITICAL - Do This First!)

Your project currently has no migration files. Before deploying to Render, you MUST create them:

```bash
cd shifa-alhind
npx prisma migrate dev --name init
```

**What this does:**

- Creates a `prisma/migrations` folder with SQL migration files
- These files are required for `prisma migrate deploy` to work in production
- Ensures your production database schema matches your Prisma schema

**Verify:**
Check that `prisma/migrations/` folder now exists with migration files.

---

### 2. Initialize Git Repository (if not already done)

```bash
cd /Users/rejaulkarim/Documents/Shifa\ Al\ Hind/shifa-alhind
git init
git add .
git commit -m "feat: Initial commit for Render deployment

- Added Prisma migrations
- Updated render.yaml with rootDir and migration commands
- Enhanced next.config.ts for production
"
```

---

### 3. Push to GitHub

```bash
# Create a new repository on GitHub first, then:
git remote add origin https://github.com/YOUR_USERNAME/shifa-alhind.git
git branch -M main
git push -u origin main
```

**Important:** Make sure `.env` is in your `.gitignore` (it should be) - never commit secrets!

---

### 4. Create PostgreSQL Database on Render

1. Go to [Render Dashboard](https://dashboard.render.com/)
2. Click **"New +"** ‚Üí **"PostgreSQL"**
3. Configure:
   - **Name:** `shifa-alhind-db`
   - **Database:** `shifa`
   - **User:** `shifa`
   - **Region:** Choose closest to your users
   - **Plan:** Free (for testing) or Starter ($7/month for production)
4. Click **"Create Database"**
5. **Save the Internal Database URL** (you'll need this)

---

### 5. Create Web Service on Render

1. Click **"New +"** ‚Üí **"Web Service"**
2. Connect your GitHub repository
3. Configure:
   - **Name:** `shifa-alhind`
   - **Branch:** `main`
   - **Root Directory:** (leave empty - render.yaml handles this)
   - **Runtime:** Node
   - **Build Command:** (leave empty - render.yaml handles this)
   - **Start Command:** (leave empty - render.yaml handles this)

4. **Environment Variables:** Click "Advanced" and add these manually:

   | Key                    | Value                               | Notes                                        |
   | ---------------------- | ----------------------------------- | -------------------------------------------- |
   | `NODE_ENV`             | `production`                        | Auto-set by render.yaml ‚úì                    |
   | `DATABASE_URL`         | _from database_                     | Auto-connected from render.yaml ‚úì            |
   | `NEXTAUTH_URL`         | `https://shifa-alhind.onrender.com` | ‚ö†Ô∏è SET MANUALLY - Use your actual Render URL |
   | `NEXTAUTH_SECRET`      | _auto-generated_                    | Auto-generated by render.yaml ‚úì              |
   | `NEXT_PUBLIC_APP_URL`  | `https://shifa-alhind.onrender.com` | ‚ö†Ô∏è SET MANUALLY - Use your actual Render URL |
   | `NEXT_PUBLIC_APP_NAME` | `Shifa AlHind`                      | Auto-set by render.yaml ‚úì                    |

   **Important:** Replace `shifa-alhind` with your actual Render app name in the URLs above!

---

### 6. Deploy

1. Click **"Create Web Service"**
2. Render will:
   - Clone your repository
   - Run `npm install`
   - Run `npx prisma migrate deploy` (applies migrations to production DB)
   - Run `npm run build` (builds your Next.js app)
   - Start the app with `npm start`

3. Monitor the build logs for any errors

---

## Troubleshooting Common Issues

### Issue: "No migration files found"

**Cause:** You didn't run `npx prisma migrate dev --name init`
**Fix:** Run it locally, commit, and push to GitHub

### Issue: "NEXTAUTH_URL is not set"

**Cause:** Environment variable not configured in Render
**Fix:** Go to Render Dashboard ‚Üí Your Service ‚Üí Environment ‚Üí Add the variable

### Issue: "Database connection failed"

**Cause:** DATABASE_URL not connected properly
**Fix:** In render.yaml, verify the database name matches your actual database name in Render

### Issue: "Build failed: TypeScript errors"

**Cause:** Your code has TypeScript errors that need fixing
**Fix:** Either fix the errors OR keep `ignoreBuildErrors: true` in next.config.ts (not recommended for production)

### Issue: "Image optimization error"

**Cause:** Next.js image optimization may need external image domains configured
**Fix:** Already configured in next.config.ts with wildcard (consider restricting in production)

---

## Post-Deployment Steps

### 1. Create Admin User

You'll need to create an admin user to access the admin panel. You can do this via Prisma Studio or a seed script:

**Option A: Using Render Shell**

1. Go to Render Dashboard ‚Üí Your Service ‚Üí Shell
2. Run:

```bash
npx prisma studio
```

3. Create a user with role `ADMIN`

**Option B: Create a seed script**
Update `prisma/seed.ts` to create an admin user, then run in Render shell:

```bash
npm run db:seed
```

### 2. Set Up Custom Domain (Optional)

1. Go to Render Dashboard ‚Üí Your Service ‚Üí Settings
2. Scroll to "Custom Domains"
3. Add your domain (e.g., `shifaalhind.com`)
4. Update DNS records as instructed
5. **Don't forget to update `NEXTAUTH_URL` and `NEXT_PUBLIC_APP_URL` to use your custom domain!**

### 3. Configure Email Service (Optional but Recommended)

For contact forms and booking notifications:

- Sign up for SendGrid (free tier: 100 emails/day)
- Add `SENDGRID_API_KEY` to Render environment variables
- Verify your sender email address

### 4. Set Up Monitoring (Recommended)

- Enable Render metrics (built-in)
- Consider adding Sentry for error tracking (add `NEXT_PUBLIC_SENTRY_DSN` env var)
- Set up UptimeRobot or similar for uptime monitoring

---

## Updating Your Deployment

Whenever you push to the `main` branch on GitHub, Render will automatically:

1. Pull the latest code
2. Run build commands
3. Deploy the new version

**For database schema changes:**

```bash
# Locally
npx prisma migrate dev --name your_migration_name
git add prisma/migrations
git commit -m "feat: Add new database migration"
git push

# Render will automatically run: npx prisma migrate deploy
```

---

## Performance Optimization Tips

1. **Enable Render's CDN** (under Settings)
2. **Use image optimization:** Already configured in next.config.ts
3. **Add caching headers** for static assets
4. **Consider upgrading** from free tier if you experience cold starts
5. **Database indexes:** Your Prisma schema already has indexes ‚úì

---

## Security Checklist

- [x] `.env` file not committed to git
- [ ] NEXTAUTH_SECRET is strong and random (Render auto-generates this)
- [ ] Database credentials are secure
- [ ] CORS configured if needed (see `.env.example` for `ALLOWED_ORIGINS`)
- [ ] Rate limiting configured (optional, see `.env.example`)
- [ ] Regular security updates (`npm audit` and fix vulnerabilities)

---

## Cost Breakdown (Render Free Tier)

- **Web Service:** Free (with limitations: spins down after 15 min inactivity)
- **PostgreSQL:** Free (1GB storage, expires after 90 days)

**For production:** Consider upgrading to:

- **Web Service:** $7/month (no sleep, more resources)
- **PostgreSQL:** $7/month (persistent, more storage)

---

## Support & Resources

- [Render Docs](https://render.com/docs)
- [Next.js Deployment](https://nextjs.org/docs/deployment)
- [Prisma Production Best Practices](https://www.prisma.io/docs/guides/deployment/deployment-guides)
- [Your project's issues](https://github.com/YOUR_USERNAME/shifa-alhind/issues)

---

## Summary

Your Shifa AlHind application is now configured for Render deployment with:

- ‚úÖ Proper build pipeline with Prisma migrations
- ‚úÖ Database connection
- ‚úÖ Environment variables configured
- ‚úÖ Production-ready Next.js settings
- ‚úÖ Automatic deployments on git push

**Next Steps:**

1. Create Prisma migrations: `npx prisma migrate dev --name init`
2. Push to GitHub
3. Follow steps 4-6 above to deploy on Render

Good luck with your deployment! üöÄ
